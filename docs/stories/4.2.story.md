# Story 4.2: AI Assistant - Conversational Coaching

## Status

**Draft**

---

## Story

**As a** trader,  
**I want** a conversational AI assistant for trading coaching,  
**so that** I can get personalized advice and learn from my trading patterns.

---

## Acceptance Criteria

1. **AC1**: Service AI assistant créé dans `src/services/ai/assistant-service.ts`.
2. **AC2**: Chat conversationnel avec contexte trading (historique utilisateur).
3. **AC3**: Streaming responses (SSE) pour latence réduite.
4. **AC4**: Conversations stockées en DB (table `CoachConversation`).
5. **AC5**: UI chat dans dashboard (composant conversationnel).
6. **AC6**: Historique conversations accessible (liste + détails).

---

## Tasks / Subtasks

- [ ] **Task 1: AI Assistant Service** (AC: 1)
  - [ ] 1.1 Créer `src/services/ai/assistant-service.ts`
  - [ ] 1.2 Service chat avec LLM (OpenAI GPT-4o)
  - [ ] 1.3 Contexte trading (historique utilisateur, stats récentes)
  - [ ] 1.4 Prompt engineering (système + contexte)

- [ ] **Task 2: Conversational Context** (AC: 2)
  - [ ] 2.1 Charger contexte trading (stats, trades récents, patterns)
  - [ ] 2.2 Injecter contexte dans prompt (historique conversation)
  - [ ] 2.3 Gestion mémoire conversation (last 10 messages)
  - [ ] 2.4 Références contexte (ex: "basé sur tes trades EUR/USD récents")

- [ ] **Task 3: Streaming Responses** (AC: 3)
  - [ ] 3.1 API endpoint `/api/ai/assistant/chat` (SSE streaming)
  - [ ] 3.2 Streaming OpenAI API (stream: true)
  - [ ] 3.3 Client React utilise EventSource ou fetch streaming
  - [ ] 3.4 UI affiche réponse progressive (typing effect)

- [ ] **Task 4: Data Model** (AC: 4)
  - [ ] 4.1 Vérifier table `CoachConversation` existe (Prisma schema)
  - [ ] 4.2 Champs : userId, messages (JSON), createdAt, updatedAt
  - [ ] 4.3 Migration Prisma si nécessaire
  - [ ] 4.4 Stocker conversations après chaque message

- [ ] **Task 5: Chat UI** (AC: 5)
  - [ ] 5.1 Composant chat dans `src/components/ai/assistant-chat.tsx`
  - [ ] 5.2 Page `/ai-assistant` ou modal/panel dashboard
  - [ ] 5.3 Input message + bouton send
  - [ ] 5.4 Affichage messages (user + assistant)
  - [ ] 5.5 Loading state (streaming réponse)

- [ ] **Task 6: Conversation History** (AC: 6)
  - [ ] 6.1 Liste conversations (sidebar ou page dédiée)
  - [ ] 6.2 Afficher dernière conversation par défaut
  - [ ] 6.3 Navigation conversations (sélectionner conversation)
  - [ ] 6.4 Supprimer conversation (optionnel)

---

## Dev Notes

- Dépendance : Epic 1 (Redis, BullMQ) et Epic 3 (Données collectées).
- ⚠️ **CRITIQUE** : Notification PM requise pour OpenAI GPT-4o API (voir roadmap).
- Streaming pour latence réduite (SSE ou fetch streaming).
- Contexte trading : utiliser stats récentes, trades patterns (Epic 3).
- Référencer `docs/architecture-trading-path-journal.md` Section 2.3.4 (AI Architecture).
- Référencer `docs/roadmap-trading-path-journal.md` Phase 3 (AI Assistant).
