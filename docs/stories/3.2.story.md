# Story 3.2: Unlimited Accounts UI - Virtual Scrolling & Lazy Loading

## Status

**Draft**

---

## Story

**As a** trader with many accounts,  
**I want** a UI that loads quickly and stays responsive with 100+ accounts,  
**so that** I can navigate my accounts efficiently.

---

## Acceptance Criteria

1. **AC1**: Liste comptes utilise virtual scrolling (react-window/react-virtual).
2. **AC2**: Lazy loading : charger uniquement comptes visibles (50 par batch).
3. **AC3**: Grouping par broker (onglets ou groupes collapsibles).
4. **AC4**: Recherche instantanée avec debouncing (trouver compte rapidement).
5. **AC5**: UI fluide même avec 100+ comptes (pas de lag, scrolling smooth).
6. **AC6**: Loading states (skeleton loaders) pendant chargement.

---

## Tasks / Subtasks

- [ ] **Task 1: Virtual Scrolling** (AC: 1)
  - [ ] 1.1 Installer react-window ou @tanstack/react-virtual
  - [ ] 1.2 Refactor `AccountsContent` pour virtual scrolling
  - [ ] 1.3 Tester avec 100+ comptes (performance)

- [ ] **Task 2: Lazy Loading** (AC: 2)
  - [ ] 2.1 API paginée pour comptes (page, limit)
  - [ ] 2.2 Infinite scroll ou pagination (charger 50 par batch)
  - [ ] 2.3 React Query pour cache + pagination

- [ ] **Task 3: Grouping by Broker** (AC: 3)
  - [ ] 3.1 Grouper comptes par broker (onglets ou accordion)
  - [ ] 3.2 UI : "FTMO Accounts", "IBKR Accounts", etc.
  - [ ] 3.3 Comptes sans broker dans groupe "Other"

- [ ] **Task 4: Search & Filter** (AC: 4)
  - [ ] 4.1 Input recherche (nom compte, broker)
  - [ ] 4.2 Debouncing (300ms) pour éviter queries excessives
  - [ ] 4.3 Filter backend (prisma where clause)
  - [ ] 4.4 Résultats instantanés (< 200ms)

- [ ] **Task 5: Performance Optimization** (AC: 5)
  - [ ] 5.1 Benchmark UI (100+ comptes, scrolling smooth)
  - [ ] 5.2 Optimiser re-renders (React.memo si nécessaire)
  - [ ] 5.3 Test performance (Lighthouse, React DevTools)

- [ ] **Task 6: Loading States** (AC: 6)
  - [ ] 6.1 Skeleton loaders pour liste comptes
  - [ ] 6.2 Loading spinner pendant fetch
  - [ ] 6.3 Empty states (aucun compte)

---

## Dev Notes

- Dépendance : Story 3.1 (Data Model) doit être complétée.
- Référencer `docs/architecture-trading-path-journal.md` Section 2.3.5 (UI Optimizations).
- Performance critique : UI fluide même avec nombreux comptes (roadmap).
- Virtual scrolling = rendu uniquement items visibles (performance).
- Référencer `docs/roadmap-trading-path-journal.md` Phase 2 (Virtual scrolling, lazy loading).
