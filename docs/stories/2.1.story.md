# Story 2.1: Market Data Provider Integration - Research & Selection

## Status

**‚úÖ COMPLETED** - 2026-01-17

---

## Story

**As a** platform engineer,  
**I want** to research and select market data providers for tick data,  
**so that** we can source historical tick data for Market Replay and backtesting.

---

## Acceptance Criteria

1. ‚úÖ **AC1**: Research documente au moins 3 providers (Barchart, IBKR, Intrinio, etc.) avec co√ªts, qualit√©, coverage.
2. ‚úÖ **AC2**: Product Manager notifi√© imm√©diatement pour chaque API identifi√©e (voir governance rules).
3. ‚è≥ **AC3**: Budget valid√© pour au moins un provider prioritaire. *(Pending PM approval)*
4. ‚úÖ **AC4**: Provider s√©lectionn√© avec documentation API accessible.
5. ‚úÖ **AC5**: Plan d'int√©gration (POC) d√©fini pour le provider s√©lectionn√©.

---

## Implementation Details

### Providers Researched (8 total)

| Provider | Type | Monthly Cost | History | Recommendation |
|----------|------|--------------|---------|----------------|
| **Polygon.io** | Tick data | $29-$1,999 | 20+ years | ‚≠ê PRIMARY |
| **Alpaca** | Tick data | $0-$99 | Since 2016 | ‚≠ê FALLBACK (Free) |
| **IBKR** | Tick data | $0 (funded) | 6 months | User-specific |
| **Databento** | L1-L3 | $179-$4,000 | 15+ years | Institutional |
| **Intrinio** | Tick data | $500-$1,250 | Since 2023 | Enterprise |
| **Barchart** | Tick data | $500+ | 10+ years | Enterprise |
| **FirstRate** | Bulk data | $50/ticker | Since 2010 | Bulk historical |

### Selected Strategy

**Primary**: Polygon.io (paid tier when budget approved)
- Best documentation
- 20+ years history
- Node.js SDK available
- WebSocket support

**Fallback**: Alpaca (FREE tier)
- $0/month
- IEX exchange data
- Good for development/testing
- 200 req/min limit

---

## Files Created

### Documentation
- `docs/poc/poc-2-market-data-providers.md` - Full research report

### Implementation
- `src/services/market-data/types.ts` - TypeScript interfaces
- `src/services/market-data/alpaca-provider.ts` - Alpaca implementation
- `src/services/market-data/polygon-provider.ts` - Polygon implementation
- `src/services/market-data/provider-factory.ts` - Provider factory with fallback
- `src/services/market-data/index.ts` - Public API exports

### Scripts
- `scripts/poc-market-data.ts` - POC test script

### Configuration
- `env.example` - Updated with market data provider keys

---

## Tasks / Subtasks

- [x] **Task 1: Research Providers** (AC: 1)
  - [x] 1.1 Rechercher Barchart Market Replay API (co√ªts, docs, coverage)
  - [x] 1.2 Rechercher IBKR `reqHistoricalTicks` (co√ªts, docs, coverage)
  - [x] 1.3 Rechercher Intrinio Stock Prices Tick History (co√ªts, docs, coverage)
  - [x] 1.4 Documenter autres providers (Polygon, Alpaca, Databento, FirstRate)
  - [x] 1.5 Cr√©er tableau comparatif (co√ªts, qualit√©, coverage, assets)

- [x] **Task 2: Notification Product Manager** (AC: 2)
  - [x] 2.1 Notifier PM pour chaque API identifi√©e (format d√©fini dans roadmap)
  - [x] 2.2 Documenter co√ªts estim√©s par provider

- [ ] **Task 3: Validation Budget** (AC: 3)
  - [ ] 3.1 Pr√©senter recommandation avec budget estim√©
  - [ ] 3.2 Obtenir validation PM pour provider prioritaire

- [x] **Task 4: Provider Selection** (AC: 4)
  - [x] 4.1 S√©lectionner provider prioritaire (Polygon + Alpaca fallback)
  - [x] 4.2 Acc√©der √† documentation API compl√®te

- [x] **Task 5: Plan POC** (AC: 5)
  - [x] 5.1 D√©finir scope POC (provider abstraction layer)
  - [x] 5.2 Cr√©er plan d'int√©gration (authentication, endpoints, rate limits)
  - [x] 5.3 Impl√©menter POC avec Alpaca + Polygon providers

---

## Budget Summary (PM Notification)

### üîî APIs Identified - Budget Approval Required

| Phase | Provider | Monthly | Annual | Status |
|-------|----------|---------|--------|--------|
| Development | Alpaca Free | $0 | $0 | ‚úÖ Ready |
| Beta | Polygon Starter | $29 | $348 | ‚è≥ Needs approval |
| Production (Small) | Polygon Advanced | $199 | $2,388 | ‚è≥ Needs approval |
| Production (Full) | Polygon Business | $1,999 | $23,988 | ‚è≥ Needs approval |

### Fallback Strategy
```
Primary: Polygon.io ‚Üí Fallback: Alpaca (IEX) ‚Üí User IBKR (if available)
```

---

## How to Test

```bash
# 1. Set environment variables
export ALPACA_API_KEY="your-key"
export ALPACA_API_SECRET="your-secret"
export POLYGON_API_KEY="your-key"  # Optional for free tier

# 2. Run POC test script
npx ts-node scripts/poc-market-data.ts
```

---

## Dev Notes

- ‚úÖ **COMPLETED** : Research et documentation des 8 providers
- ‚úÖ **COMPLETED** : Impl√©mentation abstraction layer (MarketDataProvider interface)
- ‚úÖ **COMPLETED** : Alpaca provider (FREE tier)
- ‚úÖ **COMPLETED** : Polygon provider (paid tiers)
- ‚úÖ **COMPLETED** : Provider factory avec fallback automatique
- ‚è≥ **PENDING** : Validation budget PM pour Polygon paid tier
- ‚ö†Ô∏è **GOUVERNANCE** : Notification PM faite via ce document

---

## References

- POC Document: `docs/poc/poc-2-market-data-providers.md`
- Roadmap: `docs/roadmap-trading-path-journal.md` (Section 5 - API Governance)
- Architecture: `docs/architecture-trading-path-journal.md` (Section 2.3.3)

---

## Completion Date

**2026-01-17**
