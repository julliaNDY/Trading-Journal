# Story 5.4: Liquidity Reports - Volume Impact Analysis

## Status

**Draft**

---

## Story

**As a** trader,  
**I want** liquidity reports analyzing volume impact on my trades,  
**so that** I can understand how large volumes affect execution.

---

## Acceptance Criteria

1. **AC1**: Service Liquidity Reports créé dans `src/services/analytics/liquidity-service.ts`.
2. **AC2**: Analyse impact liquidité (gros volumes vs petits volumes).
3. **AC3**: Métrique liquidité (score 0-100) calculée et stockée.
4. **AC4**: UI affiche rapports liquidité (graphique + métriques).
5. **AC5**: Visualisation corrélation volume vs slippage.
6. **AC6**: Rapports liquidité exportables (CSV/PDF).

---

## Tasks / Subtasks

- [ ] **Task 1: Liquidity Service** (AC: 1)
  - [ ] 1.1 Créer `src/services/analytics/liquidity-service.ts`
  - [ ] 1.2 Service analyse liquidité (basé sur volume trades)
  - [ ] 1.3 Calcul impact liquidité (gros volumes vs petits volumes)
  - [ ] 1.4 Analyse slippage (si données disponibles)

- [ ] **Task 2: Volume Impact Analysis** (AC: 2)
  - [ ] 2.1 Grouper trades par volume (gros vs petits volumes)
  - [ ] 2.2 Comparer performances (PnL, win rate) par groupe volume
  - [ ] 2.3 Calcul impact liquidité (slippage estimé si données disponibles)
  - [ ] 2.4 Stocker analyse en DB (table `LiquidityReport` ou calcul à la volée)

- [ ] **Task 3: Liquidity Score** (AC: 3)
  - [ ] 3.1 Calcul score liquidité 0-100 (basé sur impact volume)
  - [ ] 3.2 Stocker score en DB (Trade.liquidityScore)
  - [ ] 3.3 Migration Prisma si nécessaire
  - [ ] 3.4 Calcul après chaque trade (background job)

- [ ] **Task 4: Liquidity UI** (AC: 4)
  - [ ] 4.1 Composant LiquidityReport dans `src/components/analytics/liquidity-report.tsx`
  - [ ] 4.2 Afficher métriques (score, impact volume, slippage)
  - [ ] 4.3 Graphique liquidité (volume vs performance)
  - [ ] 4.4 Page `/liquidity-reports` ou section analytics

- [ ] **Task 5: Volume vs Slippage** (AC: 5)
  - [ ] 5.1 Graphique corrélation volume vs slippage (Recharts)
  - [ ] 5.2 Scatter plot (volume vs slippage)
  - [ ] 5.3 Stats : corrélation, tendances
  - [ ] 5.4 Tableau trades avec volumes + slippage

- [ ] **Task 6: Export Reports** (AC: 6)
  - [ ] 6.1 Export CSV (tableau données)
  - [ ] 6.2 Export PDF (rapport formaté, optionnel)
  - [ ] 6.3 Action `exportLiquidityReport(format)`
  - [ ] 6.4 UI bouton export

---

## Dev Notes

- Dépendance : Epic 3 (Données collectées).
- MVP : analyse basique (volume vs performance). Future : slippage réel si données disponibles.
- Performance : pré-calcul en background pour éviter latence.
- Référencer `docs/roadmap-trading-path-journal.md` Phase 5 (Liquidity Reports).
