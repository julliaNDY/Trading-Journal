# Story 11.1: Admin User List with Stripe Plans

## Status

**Draft**

---

## Story

**As an** admin,  
**I want** to see all users with their current Stripe subscription plans,  
**so that** I can manage subscriptions effectively.

---

## Acceptance Criteria

1. **AC1**: Admin Dashboard affiche liste utilisateurs avec colonnes : email, plan, status, date création.
2. **AC2**: Informations plan récupérées depuis Stripe via `subscriptions.list`.
3. **AC3**: Afficher nom plan, interval, date fin période actuelle.
4. **AC4**: Filtrer/rechercher utilisateurs par email, plan, status.
5. **AC5**: Performance : chargement liste < 2s (pagination si > 100 utilisateurs).

---

## Tasks / Subtasks

- [ ] **Task 1: User List with Stripe Data** (AC: 1, 2)
  - [ ] 1.1 Étendre `src/app/(dashboard)/admin/admin-content.tsx`
  - [ ] 1.2 Server action `getAllUsersWithSubscriptions()` dans `src/app/actions/admin.ts`
  - [ ] 1.3 Intégration Stripe API `customers.list` + `subscriptions.list`
  - [ ] 1.4 Joindre données Stripe avec users DB

- [ ] **Task 2: Plan Display** (AC: 3)
  - [ ] 2.1 Afficher nom plan (MONTHLY, QUARTERLY, etc.)
  - [ ] 2.2 Afficher interval (1 mois, 3 mois, etc.)
  - [ ] 2.3 Afficher date fin période actuelle (current_period_end)
  - [ ] 2.4 Badge plan (shadcn/ui Badge)

- [ ] **Task 3: Filter & Search** (AC: 4)
  - [ ] 3.1 Filtre par email (search input)
  - [ ] 3.2 Filtre par plan (select dropdown)
  - [ ] 3.3 Filtre par status (active/blocked)
  - [ ] 3.4 UI shadcn/ui Input, Select

- [ ] **Task 4: Performance & Caching** (AC: 5)
  - [ ] 4.1 Cache Stripe data (Redis) pour éviter appels API excessifs
  - [ ] 4.2 TTL cache : 5min (Stripe data change peu)
  - [ ] 4.3 Pagination si > 100 utilisateurs
  - [ ] 4.4 Benchmark chargement (< 2s)

---

## Dev Notes

- Dépendance : Phase 1 (Foundation - Redis), Stripe API.
- ⚠️ **NOTIFICATION PM** : Stripe API `subscriptions.list` requise (déjà intégré).
- Caching Stripe data pour éviter rate limits.
- Référencer `docs/roadmap-trading-path-journal.md` Phase 10 (Admin User Management).
