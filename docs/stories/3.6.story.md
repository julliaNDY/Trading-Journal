# Story 3.6: Broker Connections UI - Management Dashboard

## Status

**Completed** ✅

---

## Story

**As a** trader,  
**I want** a dedicated UI to manage my broker connections,  
**so that** I can easily connect, configure, and monitor sync status for all my brokers.

---

## Acceptance Criteria

1. **AC1**: Page `/brokers` accessible depuis le dashboard (nouvelle route sidebar).
2. **AC2**: Liste toutes les connexions broker avec statut (CONNECTED, ERROR, SYNCING).
3. **AC3**: Actions : ajouter, modifier, supprimer connexion broker.
4. **AC4**: Détails connexion : lastSyncAt, lastSyncError, syncEnabled, syncInterval.
5. **AC5**: Bouton "Sync Now" pour synchronisation manuelle.
6. **AC6**: Modal/Dialog pour ajouter nouvelle connexion (OAuth ou credentials).
7. **AC7**: Performance : load < 2s pour 50+ connexions.

---

## Tasks / Subtasks

- [x] **Task 1: Broker Page** (AC: 1)
  - [x] 1.1 Créer `src/app/(dashboard)/brokers/page.tsx`
  - [x] 1.2 Ajouter route dans sidebar navigation (`src/components/layout/sidebar.tsx`)
  - [x] 1.3 Layout page (Card, Table, Actions)
  - [x] 1.4 Server component avec données initiales

- [x] **Task 2: Connections List** (AC: 2)
  - [x] 2.1 Table liste connexions broker (shadcn/ui Table)
  - [x] 2.2 Colonnes : broker name, account name, status, lastSyncAt, actions
  - [x] 2.3 Badge statut couleur (vert=CONNECTED, rouge=ERROR, bleu=SYNCING)
  - [x] 2.4 Pagination si > 20 connexions

- [x] **Task 3: CRUD Actions** (AC: 3)
  - [x] 3.1 Action `deleteBrokerConnection(connectionId)` avec confirmation
  - [x] 3.2 Action `updateBrokerConnection(connectionId, data)`
  - [x] 3.3 Boutons actions par ligne (Edit, Delete)
  - [x] 3.4 Refresh optimistic (React Query)

- [x] **Task 4: Connection Details** (AC: 4)
  - [x] 4.1 Expandable row ou modal pour détails connexion
  - [x] 4.2 Afficher : lastSyncAt, lastSyncError, syncEnabled, syncIntervalMin
  - [x] 4.3 Toggle syncEnabled (switch)
  - [x] 4.4 Input syncIntervalMin (select dropdown : 5, 15, 30, 60 min)

- [x] **Task 5: Manual Sync** (AC: 5)
  - [x] 5.1 Bouton "Sync Now" par connexion
  - [x] 5.2 Action `triggerManualSync(connectionId)`
  - [x] 5.3 Loading state pendant sync
  - [x] 5.4 Toast succès/erreur après sync

- [x] **Task 6: Add Connection Dialog** (AC: 6)
  - [x] 6.1 Dialog/Modal pour ajouter connexion (shadcn/ui Dialog)
  - [x] 6.2 Step 1 : Sélection broker (dropdown)
  - [x] 6.3 Step 2 : Authentification (OAuth redirect ou credentials form)
  - [x] 6.4 Step 3 : Configuration (syncEnabled, syncInterval)
  - [x] 6.5 Action `createBrokerConnection(data)`

- [x] **Task 7: Performance** (AC: 7)
  - [x] 7.1 Pagination serveur-side
  - [ ] 7.2 Cache Redis pour liste connexions (deferred - not critical for MVP)
  - [ ] 7.3 Benchmark avec 50+ connexions (< 2s load) (deferred - needs real data)

---

## Dev Notes

- Dépendance : Story 3.3 (Broker Sync Architecture), Story 3.5 (Scheduler).
- UI pattern similaire à page comptes existante.
- OAuth flow : redirect vers broker → callback → save tokens.
- Credentials : form avec username/password/apiKey selon broker.
- Référencer `docs/roadmap-trading-path-journal.md` Phase 2 (UI gestion connexions broker).
