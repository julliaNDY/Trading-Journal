# Story 11.5: Admin User Detail Page

## Status

**Draft**

---

## Story

**As an** admin,  
**I want** to access a dedicated page for each user displaying storage usage, features usage frequency, API costs estimates, and account information,  
**so that** I can understand user behavior, optimize API costs, and manage accounts effectively.

---

## Acceptance Criteria

1. **AC1**: Page dédiée utilisateur accessible depuis admin dashboard (route `/admin/users/[userId]`).
2. **AC2**: Afficher espace de stockage utilisé : taille totale fichiers uploadés (screenshots, audio, etc.) par type de fichier, évolution dans le temps, limite/quota utilisateur.
3. **AC3**: Afficher fonctionnalités utilisées + fréquence : analytics d'utilisation features (dashboard, journal, calendar, statistics, import, etc.) avec fréquence (visites/jour, temps passé, dernières utilisations), tendances dans le temps.
4. **AC4**: Afficher dépenses estimées en APIs : coûts estimés par API utilisée (Google Gemini/OpenAI, Whisper, market data providers, etc.), répartition par feature, coûts totaux mensuels/an, projections futures.
5. **AC5**: Afficher informations relatives au compte : profil, abonnement, statistiques trading, activité récente, historique actions admin.
6. **AC6**: Performance : chargement page < 2s, calcul stockage < 1s (cached), estimation APIs < 500ms.

---

## Tasks / Subtasks

- [ ] **Task 1: User Detail Page** (AC: 1)
  - [ ] 1.1 Créer route `/admin/users/[userId]/page.tsx`
  - [ ] 1.2 Lien "View Details" sur chaque user dans admin list
  - [ ] 1.3 Layout page avec tabs/sections
  - [ ] 1.4 Breadcrumbs navigation (Admin > Users > User Detail)

- [ ] **Task 2: Storage Usage Display** (AC: 2)
  - [ ] 2.1 Server action `getUserStorageUsage(userId)` dans `src/app/actions/admin.ts`
  - [ ] 2.2 Calculer taille fichiers par type (screenshots, audio, etc.)
  - [ ] 2.3 Récupérer historique stockage (table `StorageUsage` ou calcul)
  - [ ] 2.4 Graphique évolution stockage dans le temps (Recharts)
  - [ ] 2.5 Afficher quota vs usage actuel (Progress bar)
  - [ ] 2.6 Cache calcul stockage (Redis) - TTL 5min

- [ ] **Task 3: Features Usage Analytics** (AC: 3)
  - [ ] 3.1 Créer table `FeatureUsage` (userId, feature, timestamp, duration)
  - [ ] 3.2 Tracking automatique utilisation features (middleware ou hooks)
  - [ ] 3.3 Server action `getUserFeatureUsage(userId, period)`
  - [ ] 3.4 Calculer fréquence par feature (visites/jour, temps moyen)
  - [ ] 3.5 Graphiques tendances utilisation (Recharts)
  - [ ] 3.6 Tableau dernières utilisations (timeline)

- [ ] **Task 4: API Costs Estimation** (AC: 4)
  - [ ] 4.1 Créer table `APICallLog` (userId, api, feature, cost, timestamp)
  - [ ] 4.2 Tracking appels APIs (Google Gemini/OpenAI, Whisper, market data, etc.)
  - [ ] 4.3 Server action `getUserAPICosts(userId, period)`
  - [ ] 4.4 Calculer coûts par API et par feature
  - [ ] 4.5 Afficher répartition coûts (pie chart Recharts)
  - [ ] 4.6 Calculer totaux mensuels/an et projections
  - [ ] 4.7 Cache estimations (Redis) - TTL 5min

- [ ] **Task 5: Account Information** (AC: 5)
  - [ ] 5.1 Section Profil : email, Discord, date inscription, dernière connexion
  - [ ] 5.2 Section Abonnement : plan actuel, statut, dates début/fin, renouvellement auto
  - [ ] 5.3 Section Statistiques Trading : nombre trades, comptes, PnL total, meilleur/pire trade
  - [ ] 5.4 Section Activité Récente : derniers imports, dernières notes journal, derniers playbooks créés
  - [ ] 5.5 Section Historique Admin : blocage/déblocage, modifications abonnement, promotions

- [ ] **Task 6: Performance Optimization** (AC: 6)
  - [ ] 6.1 Cache calculs stockage (Redis) - refresh périodique
  - [ ] 6.2 Cache analytics features (Redis) - TTL 5min
  - [ ] 6.3 Cache estimations APIs (Redis) - TTL 5min
  - [ ] 6.4 Indexes optimisés pour queries analytics (Prisma)
  - [ ] 6.5 Lazy loading sections (React Suspense)

---

## Dev Notes

- Dépendance : Phase 1 (Foundation - Redis, tracking), Phase 3 (AI APIs), Phase 2 (Features).
- Nécessite système tracking utilisation features et APIs pour données précises.
- Tables nécessaires : `FeatureUsage`, `APICallLog`, `StorageUsage` (optionnel).
- ⚠️ **IMPORTANT** : Implémenter tracking avant cette story pour avoir données réelles.
- Référencer `docs/roadmap-trading-path-journal.md` Phase 10 (Admin User Detail Page).
