# Story 8.1: Path Predictor - LLM-Powered Trade Path Simulation

## Status

**Draft**

---

## Story

**As a** trader,  
**I want** AI-powered simulation of alternative trade paths,  
**so that** I can see what-if scenarios and learn from alternative outcomes.

---

## Acceptance Criteria

1. **AC1**: Service Path Predictor créé dans `src/services/ai/path-predictor-service.ts`.
2. **AC2**: LLM fine-tuné génère 5-10 scénarios de sortie différents avec probabilités.
3. **AC3**: Génération scénarios < 5s.
4. **AC4**: Scénarios stockés en DB (table `PathPredictorScenario`).
5. **AC5**: UI affiche scénarios (graphique interactif + métriques).
6. **AC6**: Visualisation chemins alternatifs (D3.js ou Recharts).

---

## Tasks / Subtasks

- [ ] **Task 1: Path Predictor Service** (AC: 1)
  - [ ] 1.1 Créer `src/services/ai/path-predictor-service.ts`
  - [ ] 1.2 Service génération scénarios (LLM fine-tuné)
  - [ ] 1.3 Prompt engineering (historique utilisateur + trade)
  - [ ] 1.4 Génération 5-10 scénarios avec probabilités

- [ ] **Task 2: LLM Fine-Tuning** (AC: 2)
  - [ ] 2.1 ⚠️ **CRITIQUE** : Notifier PM pour OpenAI GPT-4o fine-tuned (voir roadmap)
  - [ ] 2.2 Validation budget fine-tuning (coûts élevés)
  - [ ] 2.3 Fine-tuning LLM sur historique utilisateur (si validé)
  - [ ] 2.4 Alternative : LLM avec contexte (pas de fine-tuning, MVP)
  - [ ] 2.5 Génération scénarios (5-10 scénarios avec probabilités)

- [ ] **Task 3: Performance Optimization** (AC: 3)
  - [ ] 3.1 Optimiser génération scénarios (< 5s)
  - [ ] 3.2 Cache résultats si nécessaire (même trade = mêmes scénarios)
  - [ ] 3.3 Benchmark performance (< 5s)
  - [ ] 3.4 Async processing si nécessaire (background jobs)

- [ ] **Task 4: Data Model** (AC: 4)
  - [ ] 4.1 Créer table `PathPredictorScenario` (Prisma schema)
  - [ ] 4.2 Champs : tradeId, userId, scenarios (JSON), createdAt
  - [ ] 4.3 Migration Prisma
  - [ ] 4.4 Stocker scénarios après génération

- [ ] **Task 5: Path Predictor UI** (AC: 5)
  - [ ] 5.1 Composant PathPredictor dans `src/components/ai/path-predictor.tsx`
  - [ ] 5.2 Afficher scénarios (graphique interactif + métriques)
  - [ ] 5.3 Page `/trades/[id]/path-predictor` ou section trade detail
  - [ ] 5.4 Bouton "Generate Scenarios" pour lancer génération

- [ ] **Task 6: Visualization** (AC: 6)
  - [ ] 6.1 Visualisation chemins alternatifs (D3.js ou Recharts)
  - [ ] 6.2 Graphique interactif (chemins avec PnL respectif)
  - [ ] 6.3 Probabilités affichées (tooltips ou labels)
  - [ ] 6.4 Métriques : PnL par scénario, probabilités

---

## Dev Notes

- Dépendance : Epic 4 (AI), Epic 3 (Données collectées), Epic 5 (Analytics).
- ⚠️ **CRITIQUE** : Notification immédiate PM requise pour OpenAI GPT-4o fine-tuned (voir `docs/roadmap-trading-path-journal.md` Section 5).
- Fine-tuning LLM : coûts élevés, validation budget requise.
- MVP : LLM avec contexte (pas de fine-tuning) pour valider approche.
- Référencer `docs/architecture-trading-path-journal.md` Section 4.1 (Path Predictor).
- Référencer `docs/roadmap-trading-path-journal.md` Phase 8 (Path Predictor).
