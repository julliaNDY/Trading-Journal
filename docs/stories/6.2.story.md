# Story 6.2: TTP Score - Trading Path Score Calculation

## Status

**Draft**

---

## Story

**As a** trader,  
**I want** a TTP Score (Trading Path Score) for each trade,  
**so that** I can evaluate trade execution and plan adherence (0-100).

---

## Acceptance Criteria

1. **AC1**: Service TTP Score créé dans `src/services/analytics/ttp-score-service.ts`.
2. **AC2**: Algorithme TTP Score (0-100) basé sur respect plan + exécution.
3. **AC3**: Calcul < 500ms par trade.
4. **AC4**: TTP Score stocké en DB (Trade.ttpScore).
5. **AC5**: UI affiche TTP Score sur page trade detail.
6. **AC6**: Visualisation distribution TTP Scores (histogramme).

---

## Tasks / Subtasks

- [ ] **Task 1: TTP Score Service** (AC: 1)
  - [ ] 1.1 Créer `src/services/analytics/ttp-score-service.ts`
  - [ ] 1.2 Service calcul TTP Score (algorithme scoring)
  - [ ] 1.3 Facteurs : respect plan (playbooks), exécution (entry/exit), discipline
  - [ ] 1.4 Algorithme scoring (0-100)

- [ ] **Task 2: TTP Score Algorithm** (AC: 2)
  - [ ] 2.1 Calcul respect plan (basé sur playbooks respectés)
  - [ ] 2.2 Calcul exécution (basé sur entry/exit vs optimal)
  - [ ] 2.3 Calcul discipline (basé sur Tiltmeter, emotional journal)
  - [ ] 2.4 Score final (0-100) = weighted average des facteurs
  - [ ] 2.5 Validation algorithm (tests avec données historiques)

- [ ] **Task 3: Performance Optimization** (AC: 3)
  - [ ] 3.1 Optimiser calcul TTP Score (éviter queries excessives)
  - [ ] 3.2 Benchmark calcul (< 500ms par trade)
  - [ ] 3.3 Pré-calcul en background (éviter latence)
  - [ ] 3.4 Cache résultats si nécessaire

- [ ] **Task 4: Data Model** (AC: 4)
  - [ ] 4.1 Ajouter champ Trade.ttpScore (Prisma schema)
  - [ ] 4.2 Migration Prisma
  - [ ] 4.3 Stocker TTP Score après calcul
  - [ ] 4.4 Validation (0-100 range)

- [ ] **Task 5: TTP Score UI** (AC: 5)
  - [ ] 5.1 Afficher TTP Score sur page trade detail
  - [ ] 5.2 Badge/indicator visuel (score 0-100 avec couleur)
  - [ ] 5.3 Détails score (breakdown par facteur)
  - [ ] 5.4 Tooltip avec explication score

- [ ] **Task 6: TTP Score Distribution** (AC: 6)
  - [ ] 6.1 Histogramme distribution TTP Scores (Recharts)
  - [ ] 6.2 Visualisation distribution (bins 0-100)
  - [ ] 6.3 Stats : TTP Score moyen, médian, distribution
  - [ ] 6.4 Tableau trades avec TTP Scores

---

## Dev Notes

- Dépendance : Epic 3 (Données collectées), Epic 4 (AI pour Tiltmeter), Epic 5 (Analytics).
- Performance critique : < 500ms par trade (roadmap).
- Algorithme TTP Score : à valider avec utilisateurs (roadmap).
- Pré-calcul en background pour éviter latence.
- Référencer `docs/roadmap-trading-path-journal.md` Phase 6 (TTP Score).
