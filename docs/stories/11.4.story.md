# Story 11.4: Promote User to Admin

## Status

**Draft**

---

## Story

**As an** admin,  
**I want** to promote a standard user to Admin role,  
**so that** I can delegate admin tasks.

---

## Acceptance Criteria

1. **AC1**: Admin peut sélectionner utilisateur depuis liste et promouvoir Admin.
2. **AC2**: Promotion ajoute email utilisateur à `ADMIN_EMAILS` list (ou champ DB role).
3. **AC3**: Utilisateur promu gagne accès Admin Dashboard.
4. **AC4**: Audit log enregistre action promotion (qui, quand, quel utilisateur).
5. **AC5**: Dialog confirmation avant promotion.

---

## Tasks / Subtasks

- [ ] **Task 1: Promote Action** (AC: 1)
  - [ ] 1.1 UI bouton "Promote to Admin" sur user admin
  - [ ] 1.2 Dialog confirmation avant promotion
  - [ ] 1.3 Server action `promoteUserToAdmin(userId)` dans `src/app/actions/admin.ts`
  - [ ] 1.4 UI shadcn/ui AlertDialog

- [ ] **Task 2: Role Management** (AC: 2, 3)
  - [ ] 2.1 Ajouter champ `role` à table `User` (Prisma schema) ou utiliser `ADMIN_EMAILS` array
  - [ ] 2.2 Migration Prisma (si champ role ajouté)
  - [ ] 2.3 Mettre à jour fonction `isAdmin()` pour vérifier role/email
  - [ ] 2.4 Utilisateur promu gagne accès `/admin` route

- [ ] **Task 3: Audit Logging** (AC: 4)
  - [ ] 3.1 Logger action promotion (adminId, promotedUserId, timestamp)
  - [ ] 3.2 Table `AdminAuditLog` (optionnel) ou logs système
  - [ ] 3.3 Afficher historique promotions dans admin dashboard

- [ ] **Task 4: Permissions** (AC: 3)
  - [ ] 4.1 Vérifier permissions admin dans middleware/routes
  - [ ] 4.2 Tester accès `/admin` après promotion
  - [ ] 4.3 Valider fonctionnalités admin (user management, votes, etc.)

---

## Dev Notes

- Dépendance : Phase 1 (Foundation), Admin Dashboard existant.
- Choix : champ `role` DB vs `ADMIN_EMAILS` array (déjà utilisé).
- Si champ `role` ajouté, migration Prisma nécessaire.
- Référencer `docs/roadmap-trading-path-journal.md` Phase 10 (Admin User Management).
