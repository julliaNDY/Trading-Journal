# Story 6.1: Trade Replay - Tick-by-Tick Replay UI

## Status

**Draft**

---

## Story

**As a** trader,  
**I want** to replay my trades tick-by-tick candle by candle,  
**so that** I can analyze execution and market conditions during my trades.

---

## Acceptance Criteria

1. **AC1**: Page `/trades/[id]/replay` avec interface replay trade.
2. **AC2**: Chart TradingView Lightweight Charts avec ticks streamés.
3. **AC3**: Contrôles replay (play/pause, vitesse 0.5x/1x/2x/4x, période).
4. **AC4**: Trade Replay 60fps fluide pour périodes < 1 jour.
5. **AC5**: Overlay entrées/sorties sur chart (entry price, exit price, stop loss).
6. **AC6**: Synchronisation symbole/timeframe avec trade sélectionné.

---

## Tasks / Subtasks

- [ ] **Task 1: Trade Replay Page** (AC: 1)
  - [ ] 1.1 Créer `src/app/(dashboard)/trades/[id]/replay/page.tsx`
  - [ ] 1.2 Layout replay (chart + contrôles)
  - [ ] 1.3 Navigation (lien depuis page trade detail)
  - [ ] 1.4 Server component pour données initiales (trade data)

- [ ] **Task 2: TradingView Chart Integration** (AC: 2)
  - [ ] 2.1 Composant chart TradingView Lightweight Charts
  - [ ] 2.2 Stream ticks depuis API `/api/replay/stream` (Story 2.3)
  - [ ] 2.3 Affichage ticks sur chart (candlesticks ou line chart)
  - [ ] 2.4 Performance : 60fps pour périodes < 1 jour

- [ ] **Task 3: Replay Controls** (AC: 3)
  - [ ] 3.1 Contrôles replay (play/pause, vitesse, période)
  - [ ] 3.2 Bouton play/pause (toggle)
  - [ ] 3.3 Sélection vitesse (0.5x, 1x, 2x, 4x)
  - [ ] 3.4 Sélection période (startDate, endDate)
  - [ ] 3.5 UI shadcn/ui (Button, Select, DatePicker)

- [ ] **Task 4: Performance Optimization** (AC: 4)
  - [ ] 4.1 Optimiser streaming (Story 2.3)
  - [ ] 4.2 Benchmark replay (60fps fluide)
  - [ ] 4.3 Lazy loading données (load on demand)
  - [ ] 4.4 Web Workers si nécessaire (rendering asynchrone)

- [ ] **Task 5: Trade Overlay** (AC: 5)
  - [ ] 5.1 Overlay entrées/sorties sur chart (entry price, exit price, stop loss)
  - [ ] 5.2 Markers TradingView (entry marker, exit marker, stop loss marker)
  - [ ] 5.3 Couleurs : entry (vert), exit (rouge/vert selon PnL), stop loss (orange)
  - [ ] 5.4 Tooltips avec détails (price, timestamp)

- [ ] **Task 6: Symbol/Timeframe Sync** (AC: 6)
  - [ ] 6.1 Synchronisation symbole/timeframe avec trade sélectionné
  - [ ] 6.2 Chart affiche symbole du trade (Trade.symbol)
  - [ ] 6.3 Timeframe adapté (1m, 5m, 15m selon durée trade)
  - [ ] 6.4 Auto-zoom sur période trade (openedAt → closedAt)

---

## Dev Notes

- Dépendance : Story 2.3 (Market Replay Streaming API) et Epic 2 (Market Replay Infrastructure).
- Performance critique : 60fps fluide (roadmap).
- TradingView Lightweight Charts : utiliser composant existant si disponible (vérifier code).
- Référencer `docs/roadmap-trading-path-journal.md` Phase 6 (Trade Replay).
- Référencer `docs/architecture-trading-path-journal.md` Section 2.3.3 (Market Replay).
