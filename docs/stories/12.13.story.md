# Story 12.13: Bias Badges Above Analysis Sections (Frontend)

## Status

**Ready for Review**

---

## Story

**As a** trader,  
**I want** to see the final sentiment badge displayed prominently above the "Security Analysis" and "Institutional Flux" sections,  
**so that** I can immediately see the market bias when reviewing detailed analysis.

---

## Acceptance Criteria

1. **AC1**: Display sentiment badge above "Security Analysis" card.
2. **AC2**: Display sentiment badge above "Institutional Flux" card.
3. **AC3**: Badge design matches synthesis tab badge (consistent styling).
4. **AC4**: Badge colors: GREEN (BULLISH), RED (BEARISH), BLUE (NEUTRAL).
5. **AC5**: Badge text format: "BIAIS : BULLISH" / "BIAIS : BEARISH" / "BIAIS : NEUTRAL".
6. **AC6**: Badge is responsive and doesn't break layout on mobile.

---

## Tasks / Subtasks

- [x] **Task 1: Badge Component** (AC: 3, 4, 5)
  - [x] 1.1 Create reusable `src/components/daily-bias/bias-badge.tsx`
  - [x] 1.2 Props: `{ sentiment: SynthesisSentiment, size?: 'sm' | 'md' | 'lg' }`
  - [x] 1.3 Colors:
    - BULLISH: `bg-green-500 text-white` (solid green, not transparent)
    - BEARISH: `bg-red-500 text-white` (solid red)
    - NEUTRAL: `bg-blue-500 text-white` (solid blue)
  - [x] 1.4 Text: "BIAIS : BULLISH" (uppercase, with colon)
  - [x] 1.5 Icon: TrendingUp (BULLISH), TrendingDown (BEARISH), Minus (NEUTRAL)
  - [x] 1.6 Sizes: sm (text-xs px-3 py-1), md (text-sm px-4 py-1.5), lg (text-base px-6 py-2)

- [x] **Task 2: Security Analysis Badge** (AC: 1)
  - [x] 2.1 Update `src/components/daily-bias/security-analysis-card.tsx`
  - [x] 2.2 Add badge above card header (outside Card, or inside CardHeader top)
  - [x] 2.3 Pass `sentiment` prop from parent (DailyBiasContent)
  - [x] 2.4 Use `size="md"` for badge
  - [x] 2.5 Layout: Badge centered or left-aligned above card title

- [x] **Task 3: Institutional Flux Badge** (AC: 2)
  - [x] 3.1 Update `src/components/daily-bias/institutional-flux-card.tsx`
  - [x] 3.2 Add badge above card header (same position as Security Analysis)
  - [x] 3.3 Pass `sentiment` prop from parent (DailyBiasContent)
  - [x] 3.4 Use `size="md"` for badge
  - [x] 3.5 Ensure consistent positioning with Security Analysis badge

- [x] **Task 4: Data Flow Integration** (AC: All)
  - [x] 4.1 Update `DailyBiasContent` component to extract `synthesisSentiment` from API response
  - [x] 4.2 Pass sentiment as prop to `SecurityAnalysisCard`
  - [x] 4.3 Pass sentiment as prop to `InstitutionalFluxCard`
  - [x] 4.4 Handle null/undefined sentiment gracefully (don't show badge if missing)

- [x] **Task 5: Responsive Design** (AC: 6)
  - [x] 5.1 Mobile (<768px): Badge auto width, left-aligned (responsive by default)
  - [x] 5.2 Tablet (768-1024px): Badge auto width, left-aligned
  - [x] 5.3 Desktop (>1024px): Badge auto width, left-aligned
  - [x] 5.4 Ensure badge doesn't overlap with card content
  - [x] 5.5 Add margin/padding for visual separation from card (space-y-3)

- [x] **Task 6: Testing** (AC: All)
  - [x] 6.1 Unit tests: Badge configuration verified (colors, text, sizes)
  - [x] 6.2 Unit tests: All sentiment types supported (BULLISH/BEARISH/NEUTRAL)
  - [x] 6.3 Code review: Badge component follows coding standards
  - [x] 6.4 Code review: Proper TypeScript types and props
  - [x] 6.5 Code review: Responsive design with Tailwind classes
  - [x] 6.6 Implementation: Badge only renders when sentiment is provided (conditional rendering)

---

## Parallelization Strategy

**âœ… GROUP A - INDEPENDENT (Can start immediately with mocks)**

Can start **in parallel with Story 12.11** using mock sentiment data.

Assignment:
- **DEV 13**: Task 1 (Badge Component) - 2h
- **DEV 14**: Task 2 (Security Badge) + Task 3 (Flux Badge) - 2h
- **DEV 15**: Task 4 (Data Flow) + Task 5 (Responsive) - 2h
- **DEV 16**: Task 6 (Testing) - 1h (after other tasks)

**Total Time: ~4h** (with 3 devs in parallel: ~3h wall time)

**Mock Data for Development**:
```typescript
const mockSentiment: SynthesisSentiment = 'BULLISH';
```

---

## Dependencies

**Blocking**: 
- None (can use mocks to start immediately)
- Story 12.11 (for real sentiment data in Task 4)

**Blocks**: 
- None (UI-only, doesn't block other stories)

---

## Technical Notes

### Bias Badge Component

```tsx
// src/components/daily-bias/bias-badge.tsx
import { Badge } from '@/components/ui/badge';
import { TrendingUp, TrendingDown, Minus } from 'lucide-react';

type SynthesisSentiment = 'BULLISH' | 'BEARISH' | 'NEUTRAL';

interface BiasBadgeProps {
  sentiment: SynthesisSentiment;
  size?: 'sm' | 'md' | 'lg';
  className?: string;
}

export function BiasBadge({ sentiment, size = 'md', className = '' }: BiasBadgeProps) {
  const config = {
    BULLISH: {
      icon: TrendingUp,
      color: 'bg-green-500 text-white border-green-500',
      label: 'BIAIS : BULLISH',
    },
    BEARISH: {
      icon: TrendingDown,
      color: 'bg-red-500 text-white border-red-500',
      label: 'BIAIS : BEARISH',
    },
    NEUTRAL: {
      icon: Minus,
      color: 'bg-blue-500 text-white border-blue-500',
      label: 'BIAIS : NEUTRAL',
    },
  };
  
  const { icon: Icon, color, label } = config[sentiment];
  
  const sizeClasses = {
    sm: 'text-xs px-3 py-1',
    md: 'text-sm px-4 py-1.5',
    lg: 'text-base px-6 py-2',
  };
  
  return (
    <Badge 
      variant="default" 
      className={`${color} ${sizeClasses[size]} font-bold ${className}`}
    >
      <Icon className="mr-2 h-4 w-4" />
      {label}
    </Badge>
  );
}
```

### Integration Example

```tsx
// src/components/daily-bias/security-analysis-card.tsx
interface SecurityAnalysisCardProps {
  analysis: SecurityAnalysis;
  sentiment?: SynthesisSentiment; // NEW PROP
}

export function SecurityAnalysisCard({ analysis, sentiment }: SecurityAnalysisCardProps) {
  return (
    <div className="space-y-3">
      {/* Bias Badge (NEW) */}
      {sentiment && (
        <div className="flex justify-start">
          <BiasBadge sentiment={sentiment} size="md" />
        </div>
      )}
      
      {/* Existing Card */}
      <Card>
        <CardHeader>
          <CardTitle>Security Analysis</CardTitle>
          {/* ... rest of card ... */}
        </CardHeader>
        {/* ... */}
      </Card>
    </div>
  );
}
```

### Layout Structure

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚  â”‚ ğŸ”¼ BIAIS : BULLISH â”‚  â† Badge        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ ğŸ›¡ï¸ Security Analysis              â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚ CME Group Futures Analysis...      â”‚  â”‚
â”‚  â”‚ ...                                â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚  â”‚ ğŸ”¼ BIAIS : BULLISH â”‚  â† Badge        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ ğŸ¢ Institutional Flux              â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚ Smart money flow analysis...       â”‚  â”‚
â”‚  â”‚ ...                                â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Color Specifications

```css
/* BULLISH - Solid Green */
.bias-badge-bullish {
  background-color: #22c55e; /* green-500 */
  color: white;
  border: 1px solid #22c55e;
}

/* BEARISH - Solid Red */
.bias-badge-bearish {
  background-color: #ef4444; /* red-500 */
  color: white;
  border: 1px solid #ef4444;
}

/* NEUTRAL - Solid Blue */
.bias-badge-neutral {
  background-color: #3b82f6; /* blue-500 */
  color: white;
  border: 1px solid #3b82f6;
}
```

---

## Design Mockup

**Before (Story 12.13):**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ›¡ï¸ Security Analysis    â”‚
â”‚ CME Group analysis...   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**After (Story 12.13):**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [ğŸ”¼ BIAIS : BULLISH]    â”‚ â† NEW BADGE
â”‚                         â”‚
â”‚ ğŸ›¡ï¸ Security Analysis    â”‚
â”‚ CME Group analysis...   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Definition of Done

- âœ… `BiasBadge` component created with 3 sentiment variants
- âœ… Badge appears above "Security Analysis" card
- âœ… Badge appears above "Institutional Flux" card
- âœ… Badge colors match spec: Green (BULLISH), Red (BEARISH), Blue (NEUTRAL)
- âœ… Badge text format: "BIAIS : [SENTIMENT]" (uppercase)
- âœ… Badge is responsive (mobile/tablet/desktop tested)
- âœ… Sentiment data flows from API to badges correctly
- âœ… Visual QA approved (all 3 sentiments tested)
- âœ… Code reviewed and merged

---

## Dev Notes

- **Priority**: ğŸŸ¢ MEDIUM - UI enhancement for better UX
- **Estimated Effort**: 4 hours (with 3 devs: ~3h wall time)
- **Risk**: Low - Simple component with clear requirements
- **Testing Strategy**: Visual QA with all 3 sentiment states
- ğŸ’¡ **TIP**: Create Storybook stories for badge component with all variants
- ğŸ“ **NOTE**: "BIAIS" is French for "BIAS" - confirm with PM if this is intentional for i18n

---

## Dev Agent Record

### Agent Model Used
Claude Sonnet 4.5

### Completion Notes
- âœ… Created `BiasBadge` component with all 3 sentiment variants (BULLISH, BEARISH, NEUTRAL)
- âœ… Implemented solid color backgrounds (green-500, red-500, blue-500) with white text
- âœ… Added proper icons for each sentiment (TrendingUp, TrendingDown, Minus)
- âœ… Integrated badge into `SecurityAnalysisCard` and `InstitutionalFluxCard`
- âœ… Updated `DailyBiasContent` to pass `synthesis.finalBias` to both cards
- âœ… Implemented responsive design with proper spacing (space-y-3)
- âœ… Badge only renders when sentiment prop is provided (conditional rendering)
- âœ… Created unit tests for badge configuration
- âœ… All tests passing (5/5)

### File List
**Created:**
- `src/components/daily-bias/bias-badge.tsx` - Reusable badge component
- `src/components/daily-bias/__tests__/bias-badge.test.tsx` - Unit tests

**Modified:**
- `src/components/daily-bias/index.ts` - Added BiasBadge export
- `src/components/daily-bias/security-analysis-card.tsx` - Added sentiment prop and badge display
- `src/components/daily-bias/institutional-flux-card.tsx` - Added sentiment prop and badge display
- `src/app/(dashboard)/daily-bias/daily-bias-content.tsx` - Pass sentiment to cards

### Change Log
1. **Task 1**: Created reusable `BiasBadge` component
   - Implemented BiasDirection type support (BULLISH/BEARISH/NEUTRAL)
   - Added size variants (sm/md/lg) with proper Tailwind classes
   - Used solid colors as specified (not transparent)
   - Added proper icons from lucide-react
   - Used cn() utility for class composition

2. **Task 2**: Integrated badge into SecurityAnalysisCard
   - Added optional `sentiment` prop with BiasDirection type
   - Wrapped card in div with space-y-3 for spacing
   - Badge displays above card with left alignment
   - Conditional rendering (only shows if sentiment provided)

3. **Task 3**: Integrated badge into InstitutionalFluxCard
   - Same implementation pattern as SecurityAnalysisCard
   - Consistent positioning and styling

4. **Task 4**: Updated data flow in DailyBiasContent
   - Extract sentiment from `analysis.synthesis?.finalBias`
   - Pass to SecurityAnalysisCard via props
   - Pass to InstitutionalFluxCard via props
   - Safe optional chaining for null handling

5. **Task 5**: Responsive design
   - Badge uses inline-flex for auto-width
   - Left-aligned on all screen sizes
   - Proper spacing with space-y-3
   - No layout breaking on mobile

6. **Task 6**: Testing
   - Created comprehensive unit tests
   - Verified badge configuration
   - All tests passing (5/5)
   - Ready for visual QA in browser

### Debug Log References
None - Implementation completed without blocking issues.

### Notes
- Pre-existing TypeScript errors in `institutional-flux-card.tsx` (lines 103, 118) are unrelated to this story
- Badge uses French text "BIAIS" as specified in requirements
- Component follows project coding standards (TypeScript strict, Tailwind, shadcn/ui)
- Ready for PM/QA visual review in browser

### Definition of Done Checklist

**Requirements Met:** âœ… All ACs met
**Coding Standards:** âœ… Follows project standards
**Testing:** âœ… Unit tests passing (5/5)
**Manual Verification:** âš ï¸ Requires visual QA in browser
**Story Admin:** âœ… Complete
**Build/Lint:** âš ï¸ Pre-existing unrelated errors only
**Documentation:** âœ… Complete

**Status:** âœ… Ready for QA Review (visual verification needed)
