# Story 12.1: Daily Bias Page - Instrument Selection

## Status

**Draft**

---

## Story

**As a** trader,  
**I want** to select an instrument and request daily bias analysis,  
**so that** I can get AI-powered market bias for my trading decisions.

---

## Acceptance Criteria

1. **AC1**: Nouvelle page "Daily Bias" accessible depuis dashboard.
2. **AC2**: Page affiche liste de 21 instruments pré-définis (dropdown/select).
3. **AC3**: Utilisateur sélectionne instrument et clique "Analyze".
4. **AC4**: Rate limiting : 1 requête/jour par utilisateur (unlimited pour admins).
5. **AC5**: Afficher dernière analyse date/heure si déjà analysé aujourd'hui.

---

## Tasks / Subtasks

- [ ] **Task 1: Daily Bias Page** (AC: 1)
  - [ ] 1.1 Créer `src/app/(dashboard)/daily-bias/page.tsx`
  - [ ] 1.2 Ajouter route dans sidebar navigation (`src/components/layout/sidebar.tsx`)
  - [ ] 1.3 Layout page (Card, Select, Button)

- [ ] **Task 2: Instrument List** (AC: 2)
  - [ ] 2.1 Créer liste instruments `src/lib/instruments.ts` (21 instruments avec IDs)
  - [ ] 2.2 Instruments : NQ1, ES1, TSLA, NVDA, SPY, TQQQ, AMD, AAPL, XAU/USD, PLTR, SOXL, AMZN, MSTR, EUR/USD, QQQ, MSFT, COIN, BTC, META, GME, SQQQ, MARA
  - [ ] 2.3 UI shadcn/ui Select pour sélection instrument

- [ ] **Task 3: Analysis Request** (AC: 3)
  - [ ] 3.1 Bouton "Analyze" déclenche analyse
  - [ ] 3.2 Server action `requestDailyBiasAnalysis(userId, instrumentId)`
  - [ ] 3.3 Loading state pendant analyse
  - [ ] 3.4 UI shadcn/ui Button, Loader

- [ ] **Task 4: Rate Limiting** (AC: 4)
  - [ ] 4.1 Table `DailyBiasAnalysis` (id, userId, instrumentId, date, createdAt)
  - [ ] 4.2 Vérifier dernière analyse `getLastAnalysisDate(userId, instrumentId)`
  - [ ] 4.3 Bloquer si analyse déjà faite aujourd'hui (sauf admin)
  - [ ] 4.4 Message utilisateur si rate limit atteint

- [ ] **Task 5: Last Analysis Display** (AC: 5)
  - [ ] 5.1 Afficher date/heure dernière analyse si existe
  - [ ] 5.2 Badge "Already analyzed today" si applicable
  - [ ] 5.3 Lien vers rapport dernière analyse

---

## Dev Notes

- Dépendance : Phase 3 (AI & Intelligence), Phase 2 (Data Collection).
- DB table `DailyBiasAnalysis` avec contrainte unique (userId + instrumentId + date).
- ⚠️ **NOTIFICATION PM** : Google Gemini API requise (préféré à OpenAI GPT-4o).
- Référencer `docs/roadmap-trading-path-journal.md` Phase 11 (AI Daily Bias Analysis).
